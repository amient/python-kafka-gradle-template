# Kafka Avro Python Gradle CI Template

## First time on a development machine (assuming mac)

    ./bin/python-setup-mac.sh

## First time on a CI machine (assuming debian)

    ./bin/python-setup-deb.sh

This will generate a local repository mirror of pypi converted to ivy format (gradle doesn't undersatnd pypi format):
    
    ~/pypi-ivy


## each program has to then have a setup.py

A template of `setup.py` can be generated by `generateSetupPy` for example:

 `./gradlew :module:python-kafka-consumer:generateSetupPy`.

After the initial setup.py is generated the setup() function needs to be modified with the correct entry point
to your program.

setup.py then can be comitted to the repository and afterwards doesn't have to be regenerated again.


## building is simple afterwards

For example:

    ./gradlew :python-kafka-consumer:build

## running the application using generated venv

    ./python-kafka-consumer/build/venv/bin/example_avro_consumer
    
    
## IDE Setup

- create a Python SDK using system interpreter (this works only with gradle 4.0 due to that api used by pygradle plugin)
- under the interpreter's packages add: requests, confluent-kafka and avro-python3
- use main.py to execute the avro_consumer from the IDE 
    - adding KAFKA_PORT and SCHEMA_REGISTRY_PORT environment variables
    - (these variables are automatically set both in docker and python environment when running gradle test)